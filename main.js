/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => AutoTagWords
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var AutoTagWords = class extends import_obsidian.Plugin {
  constructor() {
    super(...arguments);
    //  export means this class can be imported in other files, default means it's the main export of this file. There needs to be a main export of this file
    this.tags = [];
    // Here we will store all the tags we find in the vault. We will populate this array when the plugin loads and whenever there are changes in the vault. The tags are stored as strings. [] defines an array. string[] means it's an array of strings. We will use this array to check if a word in the editor matches any of the tags we have found in the vault. If it does, we will convert that word into a tag by adding a # in front of it.
    this.timeout = null;
  }
  // This is a variable to store a timeout. We will use this to delay the conversion of words to tags while the user is typing. This way we don't convert words to tags on every keystroke, which could be very inefficient. Instead, we will wait until the user has stopped typing for a short period of time (800 milliseconds) before we perform the conversion. If the user types again before the timeout is reached, we will clear the previous timeout and start a new one. This ensures that we only convert words to tags when the user has finished typing.
  // nodeJs.timeout is a type that represents the return value of the setTimeout function. It is used to store the identifier of the timeout so that we can clear it later if needed. The | null means that this variable can either be a NodeJS.Timeout or null. We initialize it to null because when the plugin first loads, there is no active timeout. 
  async onload() {
    console.log("Auto Tag Words: Plugin started");
    this.addCommand({
      // this refers to the plugin instance. addCommand is a method provided by the Plugin class that allows us to register a new command in Obsidian. A command is an action that can be triggered by the user, either through the command palette, a hotkey, or a button. The addCommand method takes an object as an argument, which defines the properties of the command, such as its id, name, and callback function.
      id: "auto-tag-scan-all",
      // This is a unique identifier for the command. It should be a string that describes the command and is not used by any other command in the plugin. This id can be used to reference the command programmatically, for example, if we want to trigger it from another part of the code.
      name: "Scan all files and add tags",
      // This is the name of the command that will appear in the command palette. It should be a descriptive name that tells the user what the command does. In this case, it indicates that the command will scan all files in the vault and add tags where necessary.
      callback: () => {
        console.log("Auto Tag Words: Scan started...");
        this.processAllFiles();
      }
    });
    this.updateTags();
    this.registerEvent(
      // This is a method provided by the Plugin class that allows us to register an event listener. An event listener is a function that will be called whenever a specific event occurs in Obsidian. In this case, we are listening for the 'changed' event on the metadataCache, which means that whenever there are changes to the metadata of any file (such as adding or removing tags), our callback function will be executed. This allows us to keep our list of tags up-to-date whenever there are changes in the vault.
      this.app.metadataCache.on("changed", () => {
        this.updateTags();
      })
    );
    this.registerEvent(
      // Here again, we are listening for new events.
      this.app.vault.on("modify", (file) => {
        setTimeout(() => this.processFile(file), 1e3);
      })
    );
    this.processAllFiles();
    this.registerEvent(
      this.app.workspace.on("editor-change", (editor) => {
        if (this.timeout) clearTimeout(this.timeout);
        this.timeout = setTimeout(() => this.convertWordsToTags(editor), 800);
      })
    );
  }
  // All Tags are collected and stored here.
  updateTags() {
    this.tags = [];
    const files = this.app.vault.getMarkdownFiles();
    for (const file of files) {
      const cache = this.app.metadataCache.getFileCache(file);
      if (cache == null ? void 0 : cache.tags) {
        for (const tag of cache.tags) {
          if (!this.tags.includes(tag.tag)) {
            this.tags.push(tag.tag);
          }
        }
      }
    }
    console.log(`Auto Tag Words: ${this.tags.length} Tags found`);
  }
  // A private methos is defined to escape special characters in name tags. Special charakters are often part of the Regex pattern.
  escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
  }
  // Files are processed here. This is where the content of the file is read, checked for words that match our tags, and updated if necessary.
  async processFile(file) {
    if (!file.extension.includes("md")) return;
    try {
      const content = await this.app.vault.read(file);
      let newContent = content;
      let changed = false;
      for (const tag of this.tags) {
        const word = tag.slice(1).toLowerCase();
        const escapedWord = this.escapeRegExp(word);
        const regex = new RegExp(`(?<!#)\\b${escapedWord}\\b`, "gi");
        const updatedContent = newContent.replace(regex, `#${word}`);
        if (updatedContent !== newContent) {
          newContent = updatedContent;
          changed = true;
        }
      }
      if (changed) {
        await this.app.vault.modify(file, newContent);
        console.log(`Auto Tag Words: ${file.basename} was tagged`);
      }
    } catch (error) {
      console.error(`Auto Tag Words: Dick stuck in blender ${file.basename}:`, error);
    }
  }
  // A method to look through all the files in the vault.
  async processAllFiles() {
    console.log("Auto Tag Words: Snooping through your files...");
    const files = this.app.vault.getMarkdownFiles();
    for (const file of files) {
      await this.processFile(file);
    }
    console.log("Auto Tag Words: No more snooping to be done");
  }
  convertWordsToTags(editor) {
    const text = editor.getValue();
    let changed = false;
    for (const tag of this.tags) {
      const word = tag.slice(1).toLowerCase();
      const escapedWord = this.escapeRegExp(word);
      const regex = new RegExp(`(?<!#)\\b${escapedWord}\\b`, "gi");
      const newText = text.replace(regex, `#${word}`);
      if (newText !== text) {
        editor.setValue(newText);
        changed = true;
      }
    }
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImltcG9ydCB7IEFwcCwgRWRpdG9yLCBQbHVnaW4sIFRGaWxlIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXV0b1RhZ1dvcmRzIGV4dGVuZHMgUGx1Z2luIHsgLy8gIGV4cG9ydCBtZWFucyB0aGlzIGNsYXNzIGNhbiBiZSBpbXBvcnRlZCBpbiBvdGhlciBmaWxlcywgZGVmYXVsdCBtZWFucyBpdCdzIHRoZSBtYWluIGV4cG9ydCBvZiB0aGlzIGZpbGUuIFRoZXJlIG5lZWRzIHRvIGJlIGEgbWFpbiBleHBvcnQgb2YgdGhpcyBmaWxlXHJcbiBcclxuXHR0YWdzOiBzdHJpbmdbXSA9IFtdOyAvLyBIZXJlIHdlIHdpbGwgc3RvcmUgYWxsIHRoZSB0YWdzIHdlIGZpbmQgaW4gdGhlIHZhdWx0LiBXZSB3aWxsIHBvcHVsYXRlIHRoaXMgYXJyYXkgd2hlbiB0aGUgcGx1Z2luIGxvYWRzIGFuZCB3aGVuZXZlciB0aGVyZSBhcmUgY2hhbmdlcyBpbiB0aGUgdmF1bHQuIFRoZSB0YWdzIGFyZSBzdG9yZWQgYXMgc3RyaW5ncy4gW10gZGVmaW5lcyBhbiBhcnJheS4gc3RyaW5nW10gbWVhbnMgaXQncyBhbiBhcnJheSBvZiBzdHJpbmdzLiBXZSB3aWxsIHVzZSB0aGlzIGFycmF5IHRvIGNoZWNrIGlmIGEgd29yZCBpbiB0aGUgZWRpdG9yIG1hdGNoZXMgYW55IG9mIHRoZSB0YWdzIHdlIGhhdmUgZm91bmQgaW4gdGhlIHZhdWx0LiBJZiBpdCBkb2VzLCB3ZSB3aWxsIGNvbnZlcnQgdGhhdCB3b3JkIGludG8gYSB0YWcgYnkgYWRkaW5nIGEgIyBpbiBmcm9udCBvZiBpdC5cclxuXHR0aW1lb3V0OiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsOyAvLyBUaGlzIGlzIGEgdmFyaWFibGUgdG8gc3RvcmUgYSB0aW1lb3V0LiBXZSB3aWxsIHVzZSB0aGlzIHRvIGRlbGF5IHRoZSBjb252ZXJzaW9uIG9mIHdvcmRzIHRvIHRhZ3Mgd2hpbGUgdGhlIHVzZXIgaXMgdHlwaW5nLiBUaGlzIHdheSB3ZSBkb24ndCBjb252ZXJ0IHdvcmRzIHRvIHRhZ3Mgb24gZXZlcnkga2V5c3Ryb2tlLCB3aGljaCBjb3VsZCBiZSB2ZXJ5IGluZWZmaWNpZW50LiBJbnN0ZWFkLCB3ZSB3aWxsIHdhaXQgdW50aWwgdGhlIHVzZXIgaGFzIHN0b3BwZWQgdHlwaW5nIGZvciBhIHNob3J0IHBlcmlvZCBvZiB0aW1lICg4MDAgbWlsbGlzZWNvbmRzKSBiZWZvcmUgd2UgcGVyZm9ybSB0aGUgY29udmVyc2lvbi4gSWYgdGhlIHVzZXIgdHlwZXMgYWdhaW4gYmVmb3JlIHRoZSB0aW1lb3V0IGlzIHJlYWNoZWQsIHdlIHdpbGwgY2xlYXIgdGhlIHByZXZpb3VzIHRpbWVvdXQgYW5kIHN0YXJ0IGEgbmV3IG9uZS4gVGhpcyBlbnN1cmVzIHRoYXQgd2Ugb25seSBjb252ZXJ0IHdvcmRzIHRvIHRhZ3Mgd2hlbiB0aGUgdXNlciBoYXMgZmluaXNoZWQgdHlwaW5nLlxyXG4gLy8gbm9kZUpzLnRpbWVvdXQgaXMgYSB0eXBlIHRoYXQgcmVwcmVzZW50cyB0aGUgcmV0dXJuIHZhbHVlIG9mIHRoZSBzZXRUaW1lb3V0IGZ1bmN0aW9uLiBJdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBpZGVudGlmaWVyIG9mIHRoZSB0aW1lb3V0IHNvIHRoYXQgd2UgY2FuIGNsZWFyIGl0IGxhdGVyIGlmIG5lZWRlZC4gVGhlIHwgbnVsbCBtZWFucyB0aGF0IHRoaXMgdmFyaWFibGUgY2FuIGVpdGhlciBiZSBhIE5vZGVKUy5UaW1lb3V0IG9yIG51bGwuIFdlIGluaXRpYWxpemUgaXQgdG8gbnVsbCBiZWNhdXNlIHdoZW4gdGhlIHBsdWdpbiBmaXJzdCBsb2FkcywgdGhlcmUgaXMgbm8gYWN0aXZlIHRpbWVvdXQuIFxyXG5cdGFzeW5jIG9ubG9hZCgpIHsgLy8gYXN5bmMgbWVhbnMgdGhpcyBmdW5jdGlvbiBjYW4gcGVyZm9ybSBhc3luY2hyb25vdXMgb3BlcmF0aW9ucywgc3VjaCBhcyByZWFkaW5nIGZpbGVzIG9yIHdhaXRpbmcgZm9yIGV2ZW50cy4gb25sb2FkIGlzIGEgc3BlY2lhbCBmdW5jdGlvbiBpbiBPYnNpZGlhbiBwbHVnaW5zIHRoYXQgaXMgY2FsbGVkIHdoZW4gdGhlIHBsdWdpbiBpcyBsb2FkZWQuIFRoaXMgaXMgd2hlcmUgd2Ugd2lsbCBzZXQgdXAgb3VyIHBsdWdpbiwgcmVnaXN0ZXIgY29tbWFuZHMsIGFuZCBsaXN0ZW4gZm9yIGV2ZW50cy4gT25sb2FkIGlzIHRoZSBtYWluIGVudHJ5IHBvaW50IG9mIHRoZSBwbHVnaW4uIFdoZW4gdGhlIHVzZXIgZW5hYmxlcyB0aGUgcGx1Z2luLCB0aGlzIGZ1bmN0aW9uIHdpbGwgYmUgZXhlY3V0ZWQuIFdlIHdpbGwgdXNlIHRoaXMgZnVuY3Rpb24gdG8gaW5pdGlhbGl6ZSBvdXIgcGx1Z2luLCBsb2FkIGV4aXN0aW5nIHRhZ3MgZnJvbSB0aGUgdmF1bHQsIGFuZCBzZXQgdXAgZXZlbnQgbGlzdGVuZXJzIGZvciBjaGFuZ2VzIGluIHRoZSB2YXVsdCBhbmQgZWRpdG9yLlxyXG5cdFx0Y29uc29sZS5sb2coJ0F1dG8gVGFnIFdvcmRzOiBQbHVnaW4gc3RhcnRlZCcpOyAvLyBUaGlzIGlzIGEgc2ltcGxlIGxvZyBzdGF0ZW1lbnQgdG8gaW5kaWNhdGUgdGhhdCB0aGUgcGx1Z2luIGhhcyBzdGFydGVkLiBJdCB3aWxsIGFwcGVhciBpbiB0aGUgY29uc29sZSB3aGVuIHRoZSBwbHVnaW4gaXMgbG9hZGVkLiBUaGlzIGNhbiBiZSB1c2VmdWwgZm9yIGRlYnVnZ2luZyBhbmQgY29uZmlybWluZyB0aGF0IHRoZSBwbHVnaW4gaXMgd29ya2luZy5cclxuXHRcdFxyXG5cdFx0Ly8gVGhpcyBpcyB0aGUgbWFudWFsIGNvbW1hbmQgZm9yIGNvbnNvbGUgdXNlIHRvIHRyaWdnZXIgYSB3b3JkIHNjYW4gb24gYWxsIGZpbGVzIGFuZCB0YWcgaWYgbmVjY2Vzc2FyeS5cclxuXHRcdHRoaXMuYWRkQ29tbWFuZCh7IC8vIHRoaXMgcmVmZXJzIHRvIHRoZSBwbHVnaW4gaW5zdGFuY2UuIGFkZENvbW1hbmQgaXMgYSBtZXRob2QgcHJvdmlkZWQgYnkgdGhlIFBsdWdpbiBjbGFzcyB0aGF0IGFsbG93cyB1cyB0byByZWdpc3RlciBhIG5ldyBjb21tYW5kIGluIE9ic2lkaWFuLiBBIGNvbW1hbmQgaXMgYW4gYWN0aW9uIHRoYXQgY2FuIGJlIHRyaWdnZXJlZCBieSB0aGUgdXNlciwgZWl0aGVyIHRocm91Z2ggdGhlIGNvbW1hbmQgcGFsZXR0ZSwgYSBob3RrZXksIG9yIGEgYnV0dG9uLiBUaGUgYWRkQ29tbWFuZCBtZXRob2QgdGFrZXMgYW4gb2JqZWN0IGFzIGFuIGFyZ3VtZW50LCB3aGljaCBkZWZpbmVzIHRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBjb21tYW5kLCBzdWNoIGFzIGl0cyBpZCwgbmFtZSwgYW5kIGNhbGxiYWNrIGZ1bmN0aW9uLlxyXG5cdFx0XHRpZDogJ2F1dG8tdGFnLXNjYW4tYWxsJywgLy8gVGhpcyBpcyBhIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgY29tbWFuZC4gSXQgc2hvdWxkIGJlIGEgc3RyaW5nIHRoYXQgZGVzY3JpYmVzIHRoZSBjb21tYW5kIGFuZCBpcyBub3QgdXNlZCBieSBhbnkgb3RoZXIgY29tbWFuZCBpbiB0aGUgcGx1Z2luLiBUaGlzIGlkIGNhbiBiZSB1c2VkIHRvIHJlZmVyZW5jZSB0aGUgY29tbWFuZCBwcm9ncmFtbWF0aWNhbGx5LCBmb3IgZXhhbXBsZSwgaWYgd2Ugd2FudCB0byB0cmlnZ2VyIGl0IGZyb20gYW5vdGhlciBwYXJ0IG9mIHRoZSBjb2RlLlxyXG5cdFx0XHRuYW1lOiAnU2NhbiBhbGwgZmlsZXMgYW5kIGFkZCB0YWdzJywgLy8gVGhpcyBpcyB0aGUgbmFtZSBvZiB0aGUgY29tbWFuZCB0aGF0IHdpbGwgYXBwZWFyIGluIHRoZSBjb21tYW5kIHBhbGV0dGUuIEl0IHNob3VsZCBiZSBhIGRlc2NyaXB0aXZlIG5hbWUgdGhhdCB0ZWxscyB0aGUgdXNlciB3aGF0IHRoZSBjb21tYW5kIGRvZXMuIEluIHRoaXMgY2FzZSwgaXQgaW5kaWNhdGVzIHRoYXQgdGhlIGNvbW1hbmQgd2lsbCBzY2FuIGFsbCBmaWxlcyBpbiB0aGUgdmF1bHQgYW5kIGFkZCB0YWdzIHdoZXJlIG5lY2Vzc2FyeS5cclxuXHRcdFx0Y2FsbGJhY2s6ICgpID0+IHsgLy8gVGhpcyBpcyB0aGUgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNvbW1hbmQgaXMgdHJpZ2dlcmVkLiBJbiB0aGlzIGNhc2UsIHdlIGFyZSB1c2luZyBhbiBhcnJvdyBmdW5jdGlvbiB0byBkZWZpbmUgdGhlIGNhbGxiYWNrLiBjYWxsYmFjayBpcyBhIHByb3BlcnR5IG9mIHRoZSBjb21tYW5kIG9iamVjdCB0aGF0IHNwZWNpZmllcyB3aGF0IHNob3VsZCBoYXBwZW4gd2hlbiB0aGUgdXNlciBleGVjdXRlcyB0aGUgY29tbWFuZC4gXHJcblx0XHRcdFx0Y29uc29sZS5sb2coJ0F1dG8gVGFnIFdvcmRzOiBTY2FuIHN0YXJ0ZWQuLi4nKTsgLy8gVGhpcyBsb2cgc3RhdGVtZW50IGluZGljYXRlcyB0aGF0IHRoZSBtYW51YWwgc2NhbiBoYXMgc3RhcnRlZC4gSXQgd2lsbCBhcHBlYXIgaW4gdGhlIGNvbnNvbGUgd2hlbiB0aGUgdXNlciB0cmlnZ2VycyB0aGUgY29tbWFuZC4gVGhpcyBjYW4gYmUgdXNlZnVsIGZvciBkZWJ1Z2dpbmcgYW5kIGNvbmZpcm1pbmcgdGhhdCB0aGUgY29tbWFuZCBpcyB3b3JraW5nLlxyXG5cdFx0XHRcdHRoaXMucHJvY2Vzc0FsbEZpbGVzKCk7IC8vIFRoaXMgY2FsbHMgdGhlIHByb2Nlc3NBbGxGaWxlcyBtZXRob2Qgb2YgdGhlIHBsdWdpbiwgd2hpY2ggd2Ugd2lsbCBkZWZpbmUgbGF0ZXIuIFRoaXMgbWV0aG9kIHdpbGwgZ28gdGhyb3VnaCBhbGwgdGhlIG1hcmtkb3duIGZpbGVzIGluIHRoZSB2YXVsdCBhbmQgY2hlY2sgZm9yIHdvcmRzIHRoYXQgbWF0Y2ggb3VyIHRhZ3MsIGNvbnZlcnRpbmcgdGhlbSB0byB0YWdzIGlmIG5lY2Vzc2FyeS4gQnkgY2FsbGluZyB0aGlzIG1ldGhvZCBpbiB0aGUgY2FsbGJhY2sgb2YgdGhlIGNvbW1hbmQsIHdlIGFsbG93IHRoZSB1c2VyIHRvIG1hbnVhbGx5IHRyaWdnZXIgYSBzY2FuIG9mIGFsbCBmaWxlcyB3aGVuZXZlciB0aGV5IHdhbnQsIGluIGFkZGl0aW9uIHRvIHRoZSBhdXRvbWF0aWMgc2Nhbm5pbmcgdGhhdCBoYXBwZW5zIHdoZW4gZmlsZXMgYXJlIG1vZGlmaWVkLlxyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHRcdFxyXG5cdFx0Ly8gVGFncyBhcmUgbG9hZGVkIGFuZCByZWdpc3RlcmRcclxuXHRcdHRoaXMudXBkYXRlVGFncygpOyAvLyBUaGlzIGNhbGxzIHRoZSB1cGRhdGVUYWdzIG1ldGhvZCBvZiB0aGUgcGx1Z2luLCB3aGljaCB3ZSB3aWxsIGRlZmluZSBsYXRlci4gVGhpcyBtZXRob2Qgd2lsbCBnbyB0aHJvdWdoIGFsbCB0aGUgbWFya2Rvd24gZmlsZXMgaW4gdGhlIHZhdWx0IGFuZCBjb2xsZWN0IGFsbCB0aGUgdGFncyB0aGF0IGFyZSBjdXJyZW50bHkgdXNlZCBpbiB0aG9zZSBmaWxlcy4gSXQgd2lsbCBwb3B1bGF0ZSB0aGUgdGhpcy50YWdzIGFycmF5IHdpdGggdGhlc2UgdGFncy4gQnkgY2FsbGluZyB0aGlzIG1ldGhvZCBpbiB0aGUgb25sb2FkIGZ1bmN0aW9uLCB3ZSBlbnN1cmUgdGhhdCB3aGVuIHRoZSBwbHVnaW4gc3RhcnRzLCBpdCBoYXMgYW4gdXAtdG8tZGF0ZSBsaXN0IG9mIGFsbCB0YWdzIGluIHRoZSB2YXVsdCB0byB3b3JrIHdpdGggd2hlbiBjb252ZXJ0aW5nIHdvcmRzIHRvIHRhZ3MgaW4gdGhlIGVkaXRvci4gXCJ0aGlzLlwiIHJlZmVycyB0byB0aGUgY3VycmVudCBpbnN0YW5jZSBvZiB0aGUgcGx1Z2luLCBzbyB3ZSBhcmUgY2FsbGluZyB0aGUgdXBkYXRlVGFncyBtZXRob2QgdGhhdCBiZWxvbmdzIHRvIHRoaXMgcGx1Z2luIGluc3RhbmNlLiBUaGlzIGlzIGltcG9ydGFudCB0byBkZWZpbmUgaGVyZSwgYmVjYXVzZSB3ZSBuZWVkIHRvIGhhdmUgdGhlIHRhZ3MgbG9hZGVkIGJlZm9yZSB3ZSBjYW4gc3RhcnQgY29udmVydGluZyB3b3JkcyB0byB0YWdzIGluIHRoZSBlZGl0b3Igb3IgcHJvY2Vzc2luZyBmaWxlcy5cclxuXHRcdHRoaXMucmVnaXN0ZXJFdmVudCggLy8gVGhpcyBpcyBhIG1ldGhvZCBwcm92aWRlZCBieSB0aGUgUGx1Z2luIGNsYXNzIHRoYXQgYWxsb3dzIHVzIHRvIHJlZ2lzdGVyIGFuIGV2ZW50IGxpc3RlbmVyLiBBbiBldmVudCBsaXN0ZW5lciBpcyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgd2hlbmV2ZXIgYSBzcGVjaWZpYyBldmVudCBvY2N1cnMgaW4gT2JzaWRpYW4uIEluIHRoaXMgY2FzZSwgd2UgYXJlIGxpc3RlbmluZyBmb3IgdGhlICdjaGFuZ2VkJyBldmVudCBvbiB0aGUgbWV0YWRhdGFDYWNoZSwgd2hpY2ggbWVhbnMgdGhhdCB3aGVuZXZlciB0aGVyZSBhcmUgY2hhbmdlcyB0byB0aGUgbWV0YWRhdGEgb2YgYW55IGZpbGUgKHN1Y2ggYXMgYWRkaW5nIG9yIHJlbW92aW5nIHRhZ3MpLCBvdXIgY2FsbGJhY2sgZnVuY3Rpb24gd2lsbCBiZSBleGVjdXRlZC4gVGhpcyBhbGxvd3MgdXMgdG8ga2VlcCBvdXIgbGlzdCBvZiB0YWdzIHVwLXRvLWRhdGUgd2hlbmV2ZXIgdGhlcmUgYXJlIGNoYW5nZXMgaW4gdGhlIHZhdWx0LlxyXG5cdFx0XHR0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLm9uKCdjaGFuZ2VkJywgKCkgPT4ge1xyXG5cdFx0XHRcdHRoaXMudXBkYXRlVGFncygpO1xyXG5cdFx0XHR9KVxyXG5cdFx0KTtcclxuXHRcdFxyXG5cdFx0Ly8gTG9va3MgZm9yIG5ldyBldmVudHMgd2l0aGluZyB0aGUgdmF1bHQuXHJcblx0XHR0aGlzLnJlZ2lzdGVyRXZlbnQoIC8vIEhlcmUgYWdhaW4sIHdlIGFyZSBsaXN0ZW5pbmcgZm9yIG5ldyBldmVudHMuXHJcblx0XHRcdHRoaXMuYXBwLnZhdWx0Lm9uKCdtb2RpZnknLCAoZmlsZTogVEZpbGUpID0+IHsgLy8gYXBwIGlzIGZvciBhY2Nlc3NpbmcgT2JzaWRpYW4gYXBwbGljYXRpb24sIHZhdWx0IGlzdCBmb3IgdGhlIHZhdWx0IGl0c2VsZi4gT04gaXMgZm9yIGxpc3RlbmluZyB0byBldmVudHMuIE1vZGlmeSBpcyB0cmlnZ2VyZCB3aGVuZXZlciBhIGNoYW5nZSBoYXBwZW5lZC4gZmlsZTogVEZpbGUgbWVhbnMgdGhhdCB0aGUgY2FsbGJhY2sgZnVuY3Rpb24gd2lsbCByZWNlaXZlIGEgZmlsZSBvYmplY3Qgb2YgdHlwZSBURmlsZSwgd2hpY2ggcmVwcmVzZW50cyB0aGUgZmlsZSB0aGF0IHdhcyBtb2RpZmllZC4gVGhpcyBhbGxvd3MgdXMgdG8ga25vdyB3aGljaCBmaWxlIHdhcyBjaGFuZ2VkIGFuZCBwcm9jZXNzIGl0IGFjY29yZGluZ2x5LlxyXG5cdFx0XHRcdHNldFRpbWVvdXQoKCkgPT4gdGhpcy5wcm9jZXNzRmlsZShmaWxlKSwgMTAwMCk7IC8vIEFnYWluIGEgdGltZW91dCBpcyB1c2VkIHRvIGRlbGF5IHRoZSBwcm9jZXNzaW5nIG9mIHRoZSBmaWxlLiBUaGlzIGlzIGJlY2F1c2Ugd2hlbiBhIGZpbGUgaXMgbW9kaWZpZWQsIHRoZXJlIG1pZ2h0IGJlIG11bHRpcGxlIGNoYW5nZXMgaGFwcGVuaW5nIGluIHF1aWNrIHN1Y2Nlc3Npb24gKGZvciBleGFtcGxlLCBpZiB0aGUgdXNlciBpcyBlZGl0aW5nIGEgZmlsZSBhbmQgc2F2aW5nIGl0IG11bHRpcGxlIHRpbWVzKS4gQnkgdXNpbmcgYSB0aW1lb3V0LCB3ZSBjYW4gd2FpdCB1bnRpbCB0aGUgY2hhbmdlcyBoYXZlIHNldHRsZWQgYmVmb3JlIHdlIHByb2Nlc3MgdGhlIGZpbGUuIEluIHRoaXMgY2FzZSwgd2Ugd2FpdCBmb3IgMTAwMCBtaWxsaXNlY29uZHMgKDEgc2Vjb25kKSBhZnRlciB0aGUgbW9kaWZ5IGV2ZW50IGlzIHRyaWdnZXJlZCBiZWZvcmUgd2UgY2FsbCB0aGUgcHJvY2Vzc0ZpbGUgbWV0aG9kIGZvciB0aGF0IHNwZWNpZmljIGZpbGUuIFRoaXMgaGVscHMgdG8gYXZvaWQgdW5uZWNlc3NhcnkgcHJvY2Vzc2luZyBhbmQgZW5zdXJlcyB0aGF0IHdlIGFyZSB3b3JraW5nIHdpdGggdGhlIG1vc3QgdXAtdG8tZGF0ZSB2ZXJzaW9uIG9mIHRoZSBmaWxlIGFmdGVyIGFsbCBjaGFuZ2VzIGhhdmUgYmVlbiBtYWRlLlxyXG5cdFx0XHR9KVxyXG5cdFx0KTtcclxuXHRcdFxyXG5cdFx0Ly8gV2hlbiBQbHVnaW4gc3RhcnRzLCBldmVyeSBmaWxlIGlzIGNoZWNrZWQgZm9yIG5ldyBjaGFuZ2VzLlxyXG5cdFx0dGhpcy5wcm9jZXNzQWxsRmlsZXMoKTsgLy8gcHJvY2VzcyBhbGwgZmlsZXMgaXMgc3RhcnRlZC5cclxuXHRcdFxyXG5cdFx0Ly8gVGhpcyBsaXN0ZW5lciBpcyBsb29raW5nIGZvciBjaGFuZ2VzIGluIHRoZSBlZGl0b3IuIEFuIEVkaXRvciBpcyB0aGUgYWN0dWFsIHdvcmtpbmcgYXJlYS4gU28gdGhpcyBpcyBsaXZlLlxyXG5cdFx0dGhpcy5yZWdpc3RlckV2ZW50KFxyXG5cdFx0XHR0aGlzLmFwcC53b3Jrc3BhY2Uub24oJ2VkaXRvci1jaGFuZ2UnLCAoZWRpdG9yOiBFZGl0b3IpID0+IHsgLy8gSGVyZSBpcyB0aGUgbG9jYXRpb24gZGVmaW5lZDogZWRpdG9yLiBFZGl0b3I6IEVkaXRvciBtZWFucyB0aGF0IHRoZSBjYWxsYmFjayBmdW5jdGlvbiB3aWxsIHJlY2VpdmUgYW4gZWRpdG9yIG9iamVjdCBvZiB0eXBlIEVkaXRvciwgd2hpY2ggcmVwcmVzZW50cyB0aGUgZWRpdG9yIHRoYXQgaGFzIGNoYW5nZWQuXHJcblx0XHRcdFx0aWYgKHRoaXMudGltZW91dCkgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCk7IC8vIGFnYWluIGEgdGltZW91dC5cclxuXHRcdFx0XHR0aGlzLnRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHRoaXMuY29udmVydFdvcmRzVG9UYWdzKGVkaXRvciksIDgwMCk7IC8vIGhlcmUgdGhlIHRpbWVvdXQgaXMgZGVmaW5lZC5cclxuXHRcdFx0fSlcclxuXHRcdCk7XHJcblx0fVxyXG5cclxuXHQvLyBBbGwgVGFncyBhcmUgY29sbGVjdGVkIGFuZCBzdG9yZWQgaGVyZS5cclxuXHR1cGRhdGVUYWdzKCkgeyAvLyBBIG1ldGhvZGUgY2FsbGVkIHVwZGF0ZVRhZ3MgaXMgZGVmaW5lZFxyXG5cdFx0dGhpcy50YWdzID0gW107IC8vIFRoZSB0YWdzIGFycmF5IGlzIHJlc2V0LiBUaGlzIG5lZWRzIHRvIGhhcHBlbiBldmVyeSB0aW1lIHdlIHVwZGF0ZSB0aGUgdGFncywgYmVjYXVzZSB3ZSBhbHdheXMgbmVlZCB0aGUgbGF0ZXN0IGxpc3Qgb2YgdGFncyBmcm9tIHRoZSB2YXVsdC4gU28sIG5vIGR1cGxpY2F0ZXNcclxuXHRcdGNvbnN0IGZpbGVzID0gdGhpcy5hcHAudmF1bHQuZ2V0TWFya2Rvd25GaWxlcygpOyAvLyBjb25zdCBmaWxlcyBkZWZpbmVzIGEgdW5jaGFuZ2luZyBjYXJpYWJsZSBcImZpbGVzXCIuIHRoaXMuYXBwLnZhdWx0LmdldE1hcmtkb3duRmlsZXMoKSByZXRyaWV2ZXMgYWxsIG1hcmtkb3duIGZpbGVzLlxyXG5cdFx0Zm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7IC8vIFwiZmlsZXNcIiBpcyBhbiBhcnJheSBvZiBhbGwgbWFya2Rvd24gZmlsZXMgY29sbGVjdGVkLiBTbyBoZXJlIGlzIGEgbG9vcCBnb2luZyB0aHJvdWdoIGVhY2ggb2YgdGhlIGZpbGVzIG9mIHRoZSBcImZpbGVzXCIgYXJyYXkuXHJcblx0XHRcdGNvbnN0IGNhY2hlID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUoZmlsZSk7IC8vIGNhY2hlIGlzIGRlZmluZWQgYXMgbWV0YWRhdGEgY2FjaGUgZm9yIHRoZSBjdXJyZW50IGZpbGUgaW4gdGhlIGxvb3AuIEEgbWV0YWRhdGEgY2FjaGUgaXMgYSBkYXRhIHN0cnVjdHVyZSB0aGF0IE9ic2lkaWFuIHVzZXMgdG8gc3RvcmUgaW5mb3JtYXRpb24gYWJvdXQgZmlsZXMsIHN1Y2ggYXMgdGhlaXIgdGFncywgbGlua3MsIGFuZCBvdGhlciBtZXRhZGF0YS4gQnkgY2FsbGluZyB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKSwgd2UgYXJlIHJldHJpZXZpbmcgdGhlIG1ldGFkYXRhIGNhY2hlIGZvciB0aGUgY3VycmVudCBmaWxlLCB3aGljaCBhbGxvd3MgdXMgdG8gYWNjZXNzIGl0cyB0YWdzIGFuZCBvdGhlciBpbmZvcm1hdGlvbiB3aXRob3V0IGhhdmluZyB0byByZWFkIHRoZSBmaWxlIGNvbnRlbnQgZGlyZWN0bHkuIFRoaXMgaXMgbW9yZSBlZmZpY2llbnQgYW5kIGZhc3RlciB0aGFuIHJlYWRpbmcgdGhlIGZpbGUgY29udGVudCwgZXNwZWNpYWxseSBmb3IgbGFyZ2UgZmlsZXMgb3Igd2hlbiB3ZSBvbmx5IG5lZWQgdGhlIG1ldGFkYXRhLlxyXG5cdFx0XHRpZiAoY2FjaGU/LnRhZ3MpIHsgLy8gSGVyZSB3ZSBjaGVjaywgaWYgdGhlcmUgYXJlIHRhZ3Mgc3RvcmVkIGluIHRoZSBmaWxlcyBjYWNoZS4gVGhlID8gaXMgb3B0aW9uYWwgY2hhaW5pbmcsIHdoaWNoIG1lYW5zIHRoYXQgaWYgY2FjaGUgaXMgbnVsbCBvciB1bmRlZmluZWQsIGl0IHdpbGwgbm90IHRocm93IGFuIGVycm9yIGFuZCB3aWxsIHNpbXBseSByZXR1cm4gdW5kZWZpbmVkLiBJZiB0aGVyZSBhcmUgdGFncyBpbiB0aGUgY2FjaGUsIHdlIHByb2NlZWQgdG8gbG9vcCB0aHJvdWdoIHRoZW0uXHJcblx0XHRcdFx0Zm9yIChjb25zdCB0YWcgb2YgY2FjaGUudGFncykgeyAvLyBJZiB0YWdzIGFyZSBmb3VuZCwgd2UgbG9vcCB0aHJvdWdoIGVhY2ggdGFnLlxyXG5cdFx0XHRcdFx0aWYgKCF0aGlzLnRhZ3MuaW5jbHVkZXModGFnLnRhZykpIHsgLy8gSWYgdGhpcyB0YWcgaXMgbm90IGFscmFkeSBpbiBvdXIgdGhpcy50YWdzIGFycmF5LCB3ZSBhZGQgaXQuXHJcblx0XHRcdFx0XHRcdHRoaXMudGFncy5wdXNoKHRhZy50YWcpOyAvLyBQdXNoIGFkZHMgdGhlIG5ldyB0YWcgdG8gdGhlIGVuZCBvZiB0aGUgdGhpcy50YWdzIGFycmF5LlxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0Y29uc29sZS5sb2coYEF1dG8gVGFnIFdvcmRzOiAke3RoaXMudGFncy5sZW5ndGh9IFRhZ3MgZm91bmRgKTsgLy8gSWYgYSB0YWcgaXMgZm91bmQgYW5kIGFkZGVkLCBhIG5vdGlmaWNhdGlvbiBpbiB0aGUgY29uc29sZSBpcyBjcmVhdGVkLlxyXG5cdH1cclxuXHJcblx0Ly8gQSBwcml2YXRlIG1ldGhvcyBpcyBkZWZpbmVkIHRvIGVzY2FwZSBzcGVjaWFsIGNoYXJhY3RlcnMgaW4gbmFtZSB0YWdzLiBTcGVjaWFsIGNoYXJha3RlcnMgYXJlIG9mdGVuIHBhcnQgb2YgdGhlIFJlZ2V4IHBhdHRlcm4uXHJcblx0cHJpdmF0ZSBlc2NhcGVSZWdFeHAoc3RyaW5nOiBzdHJpbmcpOiBzdHJpbmcgeyAvLyBBIHN0cmluZyBpcyB0dXJuZWQgaW50byBhIHN0cmluZyB3aXRoIGVzY2FwZWQgc3BlY2lhbCBjaGFyYWN0ZXJzLiBcclxuXHRcdHJldHVybiBzdHJpbmcucmVwbGFjZSgvWy4qKz9eJHt9KCl8W1xcXVxcXFxdL2csICdcXFxcJCYnKTsgLy8gRm9yIGV4YW1wbGU6IEZvciBUYWcgXCJDKytcIiB0aGUgKyB3b3VsZCBiZSBhIHJvdWxlIGluIHJlZ2V4LCBzbyBpdCBpcyBlc2NwYXBlZCB0byBcIkNcXCtcXCtcIiB0byBiZSB0cmVhdGVkIGFzIGEgbm9ybWFsIHN0cmluZy5cclxuXHR9XHJcblxyXG5cdC8vIEZpbGVzIGFyZSBwcm9jZXNzZWQgaGVyZS4gVGhpcyBpcyB3aGVyZSB0aGUgY29udGVudCBvZiB0aGUgZmlsZSBpcyByZWFkLCBjaGVja2VkIGZvciB3b3JkcyB0aGF0IG1hdGNoIG91ciB0YWdzLCBhbmQgdXBkYXRlZCBpZiBuZWNlc3NhcnkuXHJcblx0YXN5bmMgcHJvY2Vzc0ZpbGUoZmlsZTogVEZpbGUpIHsgLy8gXCJURmlsZVwiIHJlc3ByZXNlbnRzIGEgZmlsZSBpbiBPYnNpZGlhbi4gXCJmaWxlOiBURmlsZVwiIG1lYW5zIHRoYXQgdGhlIFwicHJvY2Vzc0ZpbGVcIiBtZXRob2QgdGFrZXMgYSBwYXJhbWV0ZXIgY2FsbGVkIFwiZmlsZVwiLCB3aGljaCBpcyBvZiB0eXByIFwiVEZpbGVcIi4gVGhpcyBhbGxvd3MgdXMgdG8gd29yayB3aXRoIHRoZSBmaWxlIG9iamVjdCBhbmQgYWNjZXNzIGl0cyBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzIHRvIHJlYWQgYW5kIG1vZGlmeSB0aGUgZmlsZSBjb250ZW50LlxyXG5cdFx0aWYgKCFmaWxlLmV4dGVuc2lvbi5pbmNsdWRlcygnbWQnKSkgcmV0dXJuOyAvLyBJZiBhIFwiZmlsZVwiIGluIHRoZSB2YXVsdCBlbmRzIGluIC5tZCwgdGhlcmVmb3JlIGlzIGEgbWFya2Rvd24gZmlsZSwgaXQgaXMgcHJvY2Vzc2VkLiBcclxuXHRcdFxyXG5cdFx0dHJ5IHsgLy8gXCJ0cnlcIiBpcyBhbiBpbnRlZ3JhdGVkIGVycm9yaGFuZGxpbmcgaW4gSmF2YVNjcmlwdC4gSWYgZXZlcnl0aGluZyBpcyBvaywgaXQgY29udGludWVzLCBpZiBub3QsIGl0IGp1bXBzIHRvIHRoZSBjYXRjaCBibG9jayBvbiB0aGUgYm90dG9tLlxyXG5cdFx0XHRjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTsgLy8gVGhlIGZpbGVzIGNvbnRlbnQgaXMgXCJyZWFkXCIgYW5kIHN0b3JlZCBpbiB0aGUgY29udGVudCB2YXJpYWJsZS4gQXdhaXQgaXMgbmVlZGVkLCBiZWNhdXNlIHJlYWRpbmcgYSBmaWxlIChhc3luY2hyb25vdXMgb3BlcmF0aW9uKSBtYXkgdGFrZSB0aW1lLiBBc3luY2hyb25vdXMgbWVhbnMgdGhhdCB0aGUgY29kZSBjYW4gY29udGludWUgd2hpbGUgd2Ugd2FpdC5cclxuXHRcdFx0bGV0IG5ld0NvbnRlbnQgPSBjb250ZW50OyAvLyBUaGUgZGlmZmVyZW5jZSBiZXR3ZWVuIGNvbnN0IGFuZCBsZXQgaXMsIHRoYXQgbGV0IGNhbiBiZSBjaGFuZ2VkIGxhdGVyLiBUaGlzIGlzIGltcG9ydGFudCwgYmVjYXVzZSB3ZSBuZWVkIHRvIG1vZGlmeSB0aGUgY29udGVudCBvZiB0aGUgZmlsZS4gbmV3Q29udGVudCBpcyBpbml0aWFsaXplZCB3aXRoIHRoZSBvcmlnaW5hbCBjb250ZW50IG9mIHRoZSBmaWxlLCBidXQgd2Ugd2lsbCB1cGRhdGUgaXQgaWYgd2UgZmluZCBhbnkgd29yZHMgdGhhdCBtYXRjaCBvdXIgdGFncy4gQnkgdXNpbmcgbGV0LCB3ZSBjYW4gcmVhc3NpZ24gbmV3Q29udGVudCB0byB0aGUgdXBkYXRlZCB2ZXJzaW9uIG9mIHRoZSBjb250ZW50IGFzIHdlIHByb2Nlc3MgaXQuXHJcblx0XHRcdGxldCBjaGFuZ2VkID0gZmFsc2U7IC8vIEluaXRpYWx5IG5vIGNoYW5nZXMgYXJlIG5lZWRlZCwgc28gY2hhbmdlZCBpcyBzZXQgdG8gZmFsc2UuIElmIGEgY2hhbmdlIGlzIG1hZGUgY2hhbmdlZCBpcyBzZXQgdG8gdHJ1ZSBiZWxsb3cuXHJcblx0XHRcdFxyXG5cdFx0XHRmb3IgKGNvbnN0IHRhZyBvZiB0aGlzLnRhZ3MpIHsgLy8gV2UgbG9vcCB0aHJvdWdoIGVhY2ggdGFnIGluIG91ciB0aGlzLnRhZ3MgYXJyYXkuXHJcblx0XHRcdFx0Y29uc3Qgd29yZCA9IHRhZy5zbGljZSgxKS50b0xvd2VyQ2FzZSgpOyAvLyBGb3IgbW9yZSBwcmVjaXNlIG1hdGNoaW5nLCB0aGUgdGFnIGdldHMgdHJhbnNmb3JtZWQgdG8gYSB3b3JkIHdpdGggbG93ZXJjYXNlIGxldHRlcnMgYW5kIHdpdGhvdXQgdGhlICMgKGluZGljYXRpbmcgYSB0YWcpLiBTbyBpdCBpcyBtYXRjaGVkIG1vcmUgYWNjdXJhdGVseS5cclxuXHRcdFx0XHRjb25zdCBlc2NhcGVkV29yZCA9IHRoaXMuZXNjYXBlUmVnRXhwKHdvcmQpOyAvLyBlc2NhcGVXb3JkIGlzIGRlZmluZWQgYXMgdGhlIHdvcmQgcHVsbGVkIGZyb20gdGhlIGZpbGUgYW5kIHJ1biB0aHJvdWdoIHRoZSBcImVzY2FwZVJlZ0V4cFwiIG1ldGhvZGUgdG8gbWFrZSBpdCByZWdleGFibGUuXHJcblx0XHRcdFx0Y29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGAoPzwhIylcXFxcYiR7ZXNjYXBlZFdvcmR9XFxcXGJgLCAnZ2knKTsgLy8gVGhlIGVzY2FwZWQgd29yZCAoZXNjYXBlV29yZCkgaXMgdGhlbiBwdXQgaW50byBhIHJlZ2V4IHBhdHRlcm4uXHJcblx0XHRcdFx0XHJcblx0XHRcdFx0Y29uc3QgdXBkYXRlZENvbnRlbnQgPSBuZXdDb250ZW50LnJlcGxhY2UocmVnZXgsIGAjJHt3b3JkfWApOyAvLyBBIG5ldyB2YXJpYWJsZSBpcyBjcmVhdGVkLCB3aGljaCByZXByZXNlbnRzIHRoZSBuZXcgY29uZW50IG9mIHRoZSBmaWxlIGFmdGVyIHJlcGxhY2luZyBhbnkgd29yZHMgd2l0aCB0aGUgY29ycmVzcG9uZGluZyB0YWcuIChmaXJzdCB3ZSBsb29rIGZvciB0aGUgd29yZCwgdGhlIHdlIHJlcGxhY2UgaXQgd2l0aCB0aGUgd29yZCBhZnRlciBhZGRpbmcgYSAjIGluZnJvbnQpXHJcblx0XHRcdFx0aWYgKHVwZGF0ZWRDb250ZW50ICE9PSBuZXdDb250ZW50KSB7IC8vIElmIFwidXBkYXRlQ29udGVudFwiIGlzIGRpZmZlcmVudCBmcm9tIFwibmV3Q29udGVudFwiIC0+IGNoYW5nZSB3YXMgbWFkZS5cclxuXHRcdFx0XHRcdG5ld0NvbnRlbnQgPSB1cGRhdGVkQ29udGVudDsgLy8gXCJuZXdDb250ZW5kXCIgaXMgdXBkYXRlZCB0byB0aGUgbmV3IHVwZGF0ZWQgdmVyc2lvbiBpbmNsdWRpbmcgdGhlIG5ldyB0YWdzLlxyXG5cdFx0XHRcdFx0Y2hhbmdlZCA9IHRydWU7IC8vIElmIGEgY2hhbmdlIHdhcyBtYWRlLCB0aGUgc3RhdHVzIGdldHMgc2V0IHRvIHRydWUuXHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdFxyXG5cdFx0XHRpZiAoY2hhbmdlZCkgeyAvLyBJZiBzdGF0dXMgY2hhbmdlZCBjaGFuZ2VzIHRvIHRydWVcclxuXHRcdFx0XHRhd2FpdCB0aGlzLmFwcC52YXVsdC5tb2RpZnkoZmlsZSwgbmV3Q29udGVudCk7IC8vIFRoZSBmaWxlIGlzIHVwZGF0ZWQgd2l0aCB0aGUgbmV3IGNvbnRlbnQgaW5nY2x1ZGluZyB0aGUgdGFncy5cclxuXHRcdFx0XHRjb25zb2xlLmxvZyhgQXV0byBUYWcgV29yZHM6ICR7ZmlsZS5iYXNlbmFtZX0gd2FzIHRhZ2dlZGApOyAvLyBBIHJlc3BlY3RpdmUgbm90aWZpY2F0aW9uIGlzIGNyZWF0ZWQgaW4gdGhlIGNvbnNvbGUuXHJcblx0XHRcdH1cclxuXHRcdH0gY2F0Y2ggKGVycm9yKSB7IC8vIEVycm9yaGFuZGxpbmcuXHJcblx0XHRcdGNvbnNvbGUuZXJyb3IoYEF1dG8gVGFnIFdvcmRzOiBEaWNrIHN0dWNrIGluIGJsZW5kZXIgJHtmaWxlLmJhc2VuYW1lfTpgLCBlcnJvcik7IC8vIEFuIGVycm9yIG1lc3NhZ2UgaXMgY3JlYXRlZFxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Ly8gQSBtZXRob2QgdG8gbG9vayB0aHJvdWdoIGFsbCB0aGUgZmlsZXMgaW4gdGhlIHZhdWx0LlxyXG5cdGFzeW5jIHByb2Nlc3NBbGxGaWxlcygpIHsgLy8gTWV0aG9kIGlzIGRlZmluZWQgYW5kIGRvZXMgbm90IHRha2UgYW55IHBhcmFtZXRlcnMuXHJcblx0XHRjb25zb2xlLmxvZygnQXV0byBUYWcgV29yZHM6IFNub29waW5nIHRocm91Z2ggeW91ciBmaWxlcy4uLicpOyAvLyBBIGNvbnNvbGUgbWVzc2FnZSBpcyBkaXNwbGF5ZWQuXHJcblx0XHRjb25zdCBmaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldE1hcmtkb3duRmlsZXMoKTsgLy8gQWxsIG1hcmtkb3duZmlsZXMgZ2V0IHB1bGxlZC4gXHJcblx0XHRcclxuXHRcdGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcykgeyAvLyBXZSB3b3JrIG91ciB3YXkgdGhyb3VnaCBhbGwgdGhlIGZpbGVzIG9mIHRoZSBcImZpbGVzXCIgYXJyYXkuXHJcblx0XHRcdGF3YWl0IHRoaXMucHJvY2Vzc0ZpbGUoZmlsZSk7IC8vIFRoZSBwcm9jZXNzIGlzIGFzeW5jcm9ub3VzLCBzbyB3ZSB3YWl0LiBUaGUgZmlsZSBpcyBwcm9jZXNzZWRcclxuXHRcdH1cclxuXHRcdGNvbnNvbGUubG9nKCdBdXRvIFRhZyBXb3JkczogTm8gbW9yZSBzbm9vcGluZyB0byBiZSBkb25lJyk7IC8vIE9uY2UgYWxsIGZpbGVzIGhhdmUgYmVlbiBjaGVja2VkLCB0aGVyZSBpcyBhIG5vdGlmaWNhdGlvbiBkaXNwbGF5ZWQgaW4gdGhlIGNvbnNvbGUuXHJcblx0fVxyXG5cclxuXHRjb252ZXJ0V29yZHNUb1RhZ3MoZWRpdG9yOiBFZGl0b3IpIHsgLy8gQSBtZXRob2QgaXMgZGVmaW5lZC4gSW4gKCkgd2UgZGVmaW5lIGEgcGFyYW1ldGVyIChcImVkaXRvclwiKSBhbmQgc2V0IGl0IHRvIGRhdGF0eXBlIFwiRWRpdG9yXCIuIFwiRWRpdG9yXCIgaXMgaW5jbHVkZWQgaW4gVHlwZXNjcmlwdC5cclxuXHRcdGNvbnN0IHRleHQgPSBlZGl0b3IuZ2V0VmFsdWUoKTsgLy8gVGhlIGVkaXRvciBnZXRzIHRoZSBjdXJycmVudCB0ZXh0IGNvbnRlbnQuXHJcblx0XHRsZXQgY2hhbmdlZCA9IGZhbHNlOyAvLyBBZ2FpbiwgYXQgdGhlIHN0YXJ0LCB3ZSBzZXQgdGhlIGNoYW5nZWQgYmFzZWxpbmUgdG8gYmUgZmFsc2UuXHJcblx0XHRcclxuXHRcdGZvciAoY29uc3QgdGFnIG9mIHRoaXMudGFncykgeyAvLyBXZSBsb29wIHRocm91Z2ggYWxsIHRoZSB0YWdzIGluIHRoZSBcInRoaXMudGFnc1wiIGFycmF5LlxyXG5cdFx0XHRjb25zdCB3b3JkID0gdGFnLnNsaWNlKDEpLnRvTG93ZXJDYXNlKCk7IC8vIEVhY2ggd29yZCBpcyBzbGljZWQgYW5kIGxvd2VyY2FzZWQsIHNvIHdlIGFyZSBtb3JlIGFjY3VyYXRlIHdoaWxlIHRhZ2dpbmcuXHJcblx0XHRcdGNvbnN0IGVzY2FwZWRXb3JkID0gdGhpcy5lc2NhcGVSZWdFeHAod29yZCk7IC8vIFRoZSBuZXcgc2xpY2VkIGFuZCBsb3dlcmNhc2VkIHdvcmQgaXMgcnVuIHRocm91Z2ggdGhlIFwiZXNjYXBlZFJlZ0V4cFwiIGZ1bmN0aW9uIHRvIGJlIGNsZWFuZWQgdXAgYW5kIHJlYWR5IHRvIGJlIHVzZWQgZm9yIHJlZ2V4aW5nLlxyXG5cdFx0XHRjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYCg/PCEjKVxcXFxiJHtlc2NhcGVkV29yZH1cXFxcYmAsICdnaScpOyAvLyBUaGUgY2xlYW5lZCB3b3JkIGlzIHBhc3RlZCBpbnRvIGEgUmVnZXggc2VhcmNoLlxyXG5cdFx0XHRcclxuXHRcdFx0Y29uc3QgbmV3VGV4dCA9IHRleHQucmVwbGFjZShyZWdleCwgYCMke3dvcmR9YCk7IC8vIEEgd29yZCBpcyByZXBsYWNlZCB3aXRoIGl0cyB0YWcuXHJcblx0XHRcdGlmIChuZXdUZXh0ICE9PSB0ZXh0KSB7IC8vIElmIHRoZSBuZXcgdGV4dCBkb2VzIG5vdCBtYXRjaCB0aGUgb2xkIHRleHQuIC0+IHRoaXMgbWVhbnMgd2UganVzdCBjaGFuZ2VkIHNvbWV0aGluZyAoY29udmVydGVkIGEgd29yZCBpbnRvIGEgdGFnKS5cclxuXHRcdFx0XHRlZGl0b3Iuc2V0VmFsdWUobmV3VGV4dCk7IC8vIFRoZSBvbGQgZWRpdG9yIGNvbnRlbnQgaXMgbm93IHJlcGxhY2VkIHdpdGggdGhlIG5ldyBjb250ZW50IGluY2x1ZGluZyB0aGUgbmV3IHRhZ3MuXHJcblx0XHRcdFx0Y2hhbmdlZCA9IHRydWU7IC8vIElmIHRoZXJlIHdhcyBhIGNoYW5nZSwgdGhlIGNoYW5nZWQgdmFyaWFibGUgZ2V0cyBzZXQgdG8gdHJ1ZS5cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxufVxyXG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsc0JBQTJDO0FBRTNDLElBQXFCLGVBQXJCLGNBQTBDLHVCQUFPO0FBQUEsRUFBakQ7QUFBQTtBQUVDO0FBQUEsZ0JBQWlCLENBQUM7QUFDbEI7QUFBQSxtQkFBaUM7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQUVqQyxNQUFNLFNBQVM7QUFDZCxZQUFRLElBQUksZ0NBQWdDO0FBRzVDLFNBQUssV0FBVztBQUFBO0FBQUEsTUFDZixJQUFJO0FBQUE7QUFBQSxNQUNKLE1BQU07QUFBQTtBQUFBLE1BQ04sVUFBVSxNQUFNO0FBQ2YsZ0JBQVEsSUFBSSxpQ0FBaUM7QUFDN0MsYUFBSyxnQkFBZ0I7QUFBQSxNQUN0QjtBQUFBLElBQ0QsQ0FBQztBQUdELFNBQUssV0FBVztBQUNoQixTQUFLO0FBQUE7QUFBQSxNQUNKLEtBQUssSUFBSSxjQUFjLEdBQUcsV0FBVyxNQUFNO0FBQzFDLGFBQUssV0FBVztBQUFBLE1BQ2pCLENBQUM7QUFBQSxJQUNGO0FBR0EsU0FBSztBQUFBO0FBQUEsTUFDSixLQUFLLElBQUksTUFBTSxHQUFHLFVBQVUsQ0FBQyxTQUFnQjtBQUM1QyxtQkFBVyxNQUFNLEtBQUssWUFBWSxJQUFJLEdBQUcsR0FBSTtBQUFBLE1BQzlDLENBQUM7QUFBQSxJQUNGO0FBR0EsU0FBSyxnQkFBZ0I7QUFHckIsU0FBSztBQUFBLE1BQ0osS0FBSyxJQUFJLFVBQVUsR0FBRyxpQkFBaUIsQ0FBQyxXQUFtQjtBQUMxRCxZQUFJLEtBQUssUUFBUyxjQUFhLEtBQUssT0FBTztBQUMzQyxhQUFL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
